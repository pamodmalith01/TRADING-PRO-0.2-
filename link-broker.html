<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Broker | TRADING PRO 0.2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Dropdown Visibility Fix */
        select option {
            background-color: #ffffff !important;
            color: #000000 !important;
        }

        .platform-btn.active {
            background: rgba(0, 242, 255, 0.1) !important;
            border-color: var(--primary) !important;
            color: #fff !important;
        }
    </style>
</head>

<body class="link-page">
    <div class="bg-blobs">
        <div class="blob"></div>
        <div class="blob blob-2"></div>
    </div>

    <nav>
        <a href="index.html" class="logo">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                <polyline points="16 7 22 7 22 13"></polyline>
            </svg>
            TRADING PRO 0.2
        </a>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="about.html">About</a>
            <a href="packages.html">Packages</a>
            <a href="ai-chat.html">AI Chat</a>
            <a href="dashboard.html">Dashboard</a>
            <a href="contact.html">Contact</a>
        </div>
        <div id="authNav" style="display: flex; gap: 1rem; align-items: center;">
            <a href="login.html" class="btn-login" style="border: none;">Login</a>
            <a href="register.html" class="btn-login" style="background: var(--primary); color: #000;">Sign Up</a>
        </div>
    </nav>

    <main
        style="padding-top: 10rem; display: flex; justify-content: center; align-items: center; min-height: 90vh; padding-bottom: 5rem;">
        <div class="dashboard-card" style="max-width: 500px; width: 90%; padding: 3rem; border-color: var(--primary);">
            <div style="text-align: center; margin-bottom: 2.5rem;">
                <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Connect MetaTrader</h1>
                <p style="color: var(--text-dim); font-size: 0.9rem;">Institutional Grade Bridge via TRADING PRO 0.2</p>
            </div>

            <form id="brokerLoginForm">
                <div class="form-group">
                    <label>Platform Type</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <button type="button" class="btn-bot platform-btn active" data-type="mt5">MT5</button>
                        <button type="button" class="btn-bot platform-btn" data-type="mt4"
                            style="background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); color: var(--text-dim);">MT4</button>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label>Select Broker</label>
                    <select id="brokerName" class="input-field"
                        style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); border-radius: 12px; color: #fff;">
                        <option value="xm">XM Global</option>
                        <option value="exness">Exness Technologies Ltd</option>
                        <option value="icmarkets">IC Markets</option>
                        <option value="octafx">OctaFX</option>
                        <option value="fxtm">FXTM</option>
                        <option value="fbs">FBS Inc.</option>
                        <option value="hfm">HFM (HotForex)</option>
                        <option value="pepperstone">Pepperstone</option>
                        <option value="tickmill">Tickmill</option>
                        <option value="avatrade">AvaTrade</option>
                        <option value="admiral">Admiral Markets</option>
                        <option value="custom">Other / Custom Broker</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Server Address</label>
                    <select id="brokerServer" class="input-field"
                        style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); border-radius: 12px; color: #fff;">
                        <!-- Servers will be populated by JS -->
                    </select>
                    <input type="text" id="customServer" class="input-field" placeholder="Enter custom server address"
                        style="display: none; width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); border-radius: 12px; color: #fff; margin-top: 0.5rem;">
                    <p style="font-size: 0.7rem; color: var(--text-dim); margin-top: 0.3rem;">Select the exact server
                        assigned to your trading account.</p>
                </div>

                <div class="form-group">
                    <label>Account Login ID</label>
                    <input type="text" id="loginId" class="input-field" placeholder="12345678" required
                        style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); border-radius: 12px; color: #fff;">
                </div>

                <div class="form-group">
                    <label>Trading Password</label>
                    <input type="password" id="loginPass" class="input-field" placeholder="••••••••••••" required
                        style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); border-radius: 12px; color: #fff;">
                </div>

                <div id="connectionLog" class="connection-log"></div>

                <div id="loginFeedback"
                    style="margin: 1.5rem 0; font-size: 0.9rem; text-align: center; height: 1.2rem;"></div>

                <button type="submit" id="linkBtn" class="btn-primary"
                    style="width: 100%; border: none; cursor: pointer; padding: 1.2rem; font-size: 1rem;">Authenticate &
                    Link</button>
            </form>

            <div
                style="margin-top: 2rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; display: flex; align-items: center; gap: 0.8rem;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <p style="font-size: 0.8rem; color: var(--text-dim);">Your credentials are encrypted via 256-bit AES
                    protocol and never stored on our central servers.</p>
            </div>
        </div>
    </main>

    <script>
        // Check authentication for protected page
        function checkAuth() {
            if (localStorage.getItem('user_authenticated') !== 'true') {
                window.location.href = 'register.html';
            }
        }
        checkAuth();

        const platformBtns = document.querySelectorAll('.platform-btn');
        let selectedPlatform = 'mt5';

        const servers = {
            xm: {
                mt5: Array.from({ length: 15 }, (_, i) => `XMGlobal-MT5-Real${i + 1}`).concat(['XMGlobal-MT5-Demo']),
                mt4: Array.from({ length: 70 }, (_, i) => `XMGlobal-Real ${i + 1}`).concat(['XMGlobal-Demo'])
            },
            exness: {
                mt5: Array.from({ length: 30 }, (_, i) => `Exness-MT5-Real ${i + 1}`).concat(['Exness-MT5-Trial']),
                mt4: Array.from({ length: 200 }, (_, i) => `Exness-Real ${i + 1}`).concat(['Exness-Trial', 'Exness-Trial 2'])
            },
            icmarkets: {
                mt5: ['ICMarkets-MT5-Real', 'ICMarkets-MT5-Real 2', 'ICMarkets-MT5-Demo'],
                mt4: Array.from({ length: 50 }, (_, i) => `ICMarkets-Real ${i + 1}`).concat(['ICMarkets-Demo'])
            },
            octafx: {
                mt5: ['OctaFX-MT5-Real', 'OctaFX-MT5-Demo'],
                mt4: ['OctaFX-Real 1', 'OctaFX-Real 2', 'OctaFX-Demo']
            },
            fxtm: {
                mt5: ['FXTM-MT5-Real', 'FXTM-MT5-Demo'],
                mt4: ['FXTM-Real 1', 'FXTM-Real 2', 'FXTM-Demo']
            },
            fbs: {
                mt5: ['FBS-Real', 'FBS-Real 2', 'FBS-Demo'],
                mt4: Array.from({ length: 40 }, (_, i) => `FBS-Real ${i + 1}`).concat(['FBS-Demo'])
            },
            hfm: {
                mt5: ['HFM-MT5-Live', 'HFM-MT5-Demo'],
                mt4: Array.from({ length: 20 }, (_, i) => `HFM-Live-Server ${i + 1}`).concat(['HFM-Demo'])
            },
            pepperstone: {
                mt5: ['Pepperstone-MT5-Edge', 'Pepperstone-Demo'],
                mt4: Array.from({ length: 20 }, (_, i) => `Pepperstone-Edge-${String(i + 1).padStart(2, '0')}`).concat(['Pepperstone-Demo'])
            },
            tickmill: {
                mt5: ['Tickmill-MT5-Real', 'Tickmill-MT5-Demo'],
                mt4: ['Tickmill-Real-01', 'Tickmill-Real-02', 'Tickmill-Demo']
            },
            avatrade: {
                mt5: ['Ava-MT5-Real', 'Ava-Demo'],
                mt4: ['Ava-Real-01', 'Ava-Real-02', 'Ava-Demo']
            },
            admiral: {
                mt5: ['AdmiralMarkets-MT5', 'AdmiralMarkets-MT5-Demo'],
                mt4: ['AdmiralMarkets-MT4-Real-1', 'AdmiralMarkets-MT4-Demo']
            }
        };

        const brokerSelect = document.getElementById('brokerName');
        const serverSelect = document.getElementById('brokerServer');
        const customServerInput = document.getElementById('customServer');

        function updateServers() {
            const broker = brokerSelect.value;
            serverSelect.innerHTML = '';

            if (broker === 'custom') {
                serverSelect.style.display = 'none';
                customServerInput.style.display = 'block';
                return;
            }

            serverSelect.style.display = 'block';
            customServerInput.style.display = 'none';

            const serverList = servers[broker][selectedPlatform];
            serverList.forEach(srv => {
                const opt = document.createElement('option');
                opt.value = srv;
                opt.innerText = srv;
                serverSelect.appendChild(opt);
            });
        }

        brokerSelect.addEventListener('change', updateServers);

        platformBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                platformBtns.forEach(b => {
                    b.style.background = 'rgba(255,255,255,0.05)';
                    b.style.borderColor = 'var(--border-color)';
                    b.style.color = 'var(--text-dim)';
                });
                btn.style.background = 'rgba(0, 242, 255, 0.1)';
                btn.style.borderColor = 'var(--primary)';
                btn.style.color = '#fff';
                selectedPlatform = btn.dataset.type;
                updateServers();
            });
        });

        const loginForm = document.getElementById('brokerLoginForm');
        const feedback = document.getElementById('loginFeedback');
        const linkBtn = document.getElementById('linkBtn');

        loginForm.onsubmit = async (e) => {
            e.preventDefault();

            const server = brokerSelect.value === 'custom' ? customServerInput.value : serverSelect.value;
            const login = document.getElementById('loginId').value;
            const pass = document.getElementById('loginPass').value;
            const logBox = document.getElementById('connectionLog');
            const card = document.querySelector('.dashboard-card');

            if (brokerSelect.value === 'custom' && !server) {
                alert("Please enter a custom server address!");
                return;
            }

            // UI Reset
            linkBtn.disabled = true;
            feedback.innerText = "";
            logBox.innerHTML = "";
            logBox.style.display = "block";

            const addLog = (msg, type = '') => {
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.innerText = `> ${new Date().toLocaleTimeString().split(' ')[0]} | ${msg}`;
                logBox.appendChild(entry);
                logBox.scrollTop = logBox.scrollHeight;
            };

            addLog(`Initializing ${selectedPlatform.toUpperCase()} Bridge...`);
            addLog(`Requesting connection to ${server}...`);

            await new Promise(r => setTimeout(r, 1200));

            // MT5-like Validation Logic
            const isIdValid = /^\d+$/.test(login) && login.length >= 6;
            const isPassValid = pass.length >= 8;

            if (!isIdValid || !isPassValid) {
                addLog(`Connection Error: Authentication failed (Invalid credentials)`, 'error');
                card.classList.add('shake');
                setTimeout(() => card.classList.remove('shake'), 400);

                feedback.innerText = "Error: Invalid Account ID or Password!";
                feedback.style.color = "#ff3e3e";
                linkBtn.disabled = false;
                return;
            }

            addLog(`Server responded: Authorized.`, 'success');
            addLog(`Retrieving account metadata for ticket sync...`);

            await new Promise(r => setTimeout(r, 1500));

            addLog(`Security token established. Bridge active.`, 'success');

            // Seeded Balance Generation
            const seed = parseInt(login.slice(-3)) || 50;
            const mockBalance = (seed * 150) + 1250.50;
            const mockDeposit = mockBalance * 0.85;

            addLog(`Account Synchronized. Balance: $${mockBalance.toFixed(2)}`, 'success');
            feedback.innerText = "Successfully Linked via Institutional Node!";
            feedback.style.color = "var(--accent)";
            linkBtn.innerText = "Redirecting...";

            localStorage.setItem('trading_linked', 'true');
            localStorage.setItem('broker_server', server);
            localStorage.setItem('account_id', login);
            localStorage.setItem('account_balance', mockBalance.toFixed(2));
            localStorage.setItem('account_deposit', mockDeposit.toFixed(2));
            localStorage.setItem('account_platform', selectedPlatform.toUpperCase());

            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 1000);
        };

        updateServers();
    </script>
    <script src="main.js"></script>
</body>

</html>